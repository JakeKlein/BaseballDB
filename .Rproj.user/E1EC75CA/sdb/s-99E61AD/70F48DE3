{
    "collab_server" : "",
    "contents" : "###Load Libraries\nrequire(devtools)\ninstall_github(\"BillPetti/baseballr\")\ninstall_github(\"cpsievert/pitchRX\")\ninstall_github(\"JakeKlein/BaseballDB\")\nrequire(baseballr)\nrequire(pitchRx)\nloader(\"dplyr\")\nloader(\"dbplyr\")\nloader(\"lubridate\")\nloader(\"tidyr\")\nloader(\"reldist\")\nloader(\"XML\")\nloader(\"xml2\")\nloader(\"magrittr\")\n###Functions\n\nred_button<-function(input='no'){\n  input=as.character(input)\n  if(input=='yes'){\n    if(file.exists(\"pitchfx.sqlite3\"))file.remove(\"pitchfx.sqlite3\");\n    print(\"You have pushed the red button\");\n    print(\"This console will self destruct\");\n  }\n  if(input=='yes')remove(list=ls())\n}\n\n###Initialize\ninitialize=1 #set to 1 if building database, 0 if updating\nstart=\"2015-04-05\"\nstop=\"2015-10-30\"\n\n\n\n\n  \n###SetUp SQLite PitchFX Connection\nMLBdb<-src_sqlite(\"pitchfx.sqlite3\",create=T)\nscrape(start=as.character(start),end=as.character(stop),connect=MLBdb$con)\nrequire(data.table)\n\n\n\n\n\n\n\n###Collect Pitchfx Data\npitchfx_scrape<-data.table(collect(tbl(MLBdb,\"pitch\")))\n\npitchfx_columns=c(\"gameday_link\",\"num\",\"id\",'pitch_type',\"start_speed\",\"end_speed\",\"sz_top\",\"sz_bot\",\"pfx_x\",\"pfx_z\",\n                  \"x0\",\"y0\",'z0','vx0','vy0','vz0','ax','ay','az','url',\"sv_id\",\"tfs_zulu\")\n\npitchfx_col_names=c(\"gameday_link\",\"eventseq\",\"pitchnum\",\"fxtype\",\"fxvelocity\",\"zone_speed\",\"sz_top\",\"sz_bot\",\n                    \"breakx\",\"breakz\",\"x0\",\"y0\",'z0','vx0','vy0','vz0','ax','ay','az','url','statcastid',\"gametime\")\n\npitchfx=pitchfx_scrape[,..pitchfx_columns]\n\ncolnames(pitchfx)<-pitchfx_col_names\n\npitchfx[,pitchseq:=rank(pitchnum,ties.method='min'),by=c(\"gameday_link\",\"eventseq\")]\n\nsetDT(pitchfx)[,c(\"gid\",\"yearid\",\"month\",\"day\",\"away_team\",\"home_team\",\"game\"):=tstrsplit(gameday_link,\"_\")]\n\npitchfx$gamedate=as.Date(paste(paste(pitchfx$yearid,pitchfx$month,sep=\"-\"),pitchfx$day,sep=\"-\"))\n\npitchfx$away_team=sapply(pitchfx$away_team,replace,USE.NAMES=FALSE)\n\npitchfx$home_team=sapply(pitchfx$home_team,replace,USE.NAMES=FALSE)\n\npitchfx[,c(\"gid\",\"yearid\",\"month\",\"day\"):=NULL]\n\npitchfx$gametime=as.POSIXct(gsub(\"Z\",\"\",gsub(\"T\",\" \",pitchfx$gametime)),tz=\"UTC\")\n\n\n###Collect Statcast Pitching Data\nstatcast_pitching=data.table(scrape_statcast_savant_pitcher_all(start,stop))\n\nstatcast_pitching_columns=c(\"game_pk\",\"at_bat_number\",\"pitch_number\",\"pitch_type\",\"game_date\",\"release_speed\",\"release_pos_x\",\"release_pos_z\",\"release_pos_y\",\"player_name\",\"batter\",\"pitcher\",\n                   \"events\",\"description\",\"zone\",\"game_type\",\"stand\",\"p_throws\",\"home_team\",\"away_team\",\"type\",\n                   \"hit_location\",\"bb_type\",\"balls\",\"strikes\",\"game_year\",\"plate_x\",\"plate_z\",\"on_1b\",\"on_2b\",\"on_3b\",\"outs_when_up\",\n                   \"inning\",\"inning_topbot\",\"hc_x\",\"hc_y\",\"sv_id\",\"sz_top\",\"sz_bot\",\"hit_distance_sc\",\"launch_speed\",\"launch_angle\",\n                   \"effective_speed\",\"release_spin_rate\",\"release_extension\",\"pos1_person_id\",\"pos2_person_id\",\"pos3_person_id\",\n                   \"pos4_person_id\",\"pos5_person_id\",\"pos6_person_id\",\"pos7_person_id\",\"pos8_person_id\",\"pos9_person_id\",\"woba_value\",\n                   \"woba_denom\",\"babip_value\",\"iso_value\")\n\nstatcast_pitching_col_names=c(\"gameid\",\"eventseq\",\"pitchseq\",\"pitch_type\",\"gamedate\",\"velocity\",\"rel_x\",\"rel_z\",\"rel_y\",\"pitcher_name\",\"batterid\",\"pitcherid\",\n                     \"event\",\"description\",\"gameday_zone\",\"game_type\",\"batter_hand\",\"pitcher_throws\",\"home_team\",\"away_team\",\"pitch_result\",\n                     \"bipfielderpos\",\"batted_ball_type\",\"balls\",\"strikes\",\"yearid\",\"plate_x\",\"plate_z\",\"runneron_1b\",\"runneron_2b\",\"runneron_3b\",\"outs\",\n                     \"inning\",\"istop\",\"bip_x\",\"bip_y\",\"statcastid\",\"sz_top\",\"sz_bot\",\"hit_distance\",\"launch_speed\",\"launch_angle\",\n                     \"perceived_velocity\",\"spinrate\",\"extension\",\"pos1_id\",\"pos2_id\",\"pos3_id\",\"pos4_id\",\"pos5_id\",\"pos6_id\",\"pos7_id\",\"pos8_id\",\"pos9_id\",\n                     \"woba_value\",\"pa\",\"babip_value\",\"iso_value\")\n\nstatcast<-statcast_pitching[,..statcast_pitching_columns]\ncolnames(statcast)<-statcast_pitching_col_names\nstatcast[,game:=rank(-gameid,ties.method='min'),by=c(\"home_team\",\"away_team\",\"gamedate\")]\nstatcast$game[statcast$game>1]=2\nstatcast$game=as.character(statcast$game)\nstatcast$gamedate=as.Date(statcast$gamedate)\npitching<-merge(statcast,pitchfx,by.x=c(\"gamedate\",\"home_team\",\"away_team\",\"eventseq\",\"pitchseq\",\"game\",'sz_top','sz_bot',\"pitch_type\"),by.y=c(\"gamedate\",\"home_team\",\"away_team\",\"eventseq\",\"pitchseq\",\"game\",'sz_top','sz_bot',\"fxtype\"))\n\n\n\n\n###Collect Batter Names\nstatcast_hitting=data.table(scrape_statcast_savant_batter_all(start,stop))\n\nstatcast_hitting_columns=c(\"game_pk\",\"at_bat_number\",\"pitch_number\",\"player_name\",\"batter\",\"sz_top\",\"sz_bot\",\"pitch_type\")\nstatcast_hitting_col_names=c(\"gameid\",\"eventseq\",\"pitchseq\",\"batter_name\",\"batterid\",\"sz_top\",\"sz_bot\",\"pitch_type\")\n\nstatcast_hit<-statcast_hitting[,..statcast_hitting_columns]\ncolnames(statcast_hit)=statcast_hitting_col_names\n\nall_data=merge(pitching,statcast_hit,by=c(\"gameid\",\"eventseq\",\"pitchseq\",\"batterid\",\"sz_top\",\"sz_bot\",\"pitch_type\"),all.x='True')\n\n                \n                   \n                   \n                   \n                   \n                   \n             \n                   \n                   \n                   \n                   \n                   \n                   \n                   \n                   \ni=0                   \nwhile (i<6){\n  print(i)\n  i=i+1}\nelse \n  print(\"i greater than 5\")                   \n                   \n                   \n                   \n                   \n                   \n                   \n                   \n                   \n                   \n                   \n                   \n                   \n                   \n                   \n                   \n                   \n  ",
    "created" : 1510071016410.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "211565958",
    "id" : "70F48DE3",
    "lastKnownWriteTime" : 1510087071,
    "last_content_update" : 1510087071,
    "path" : "~/MLB.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}