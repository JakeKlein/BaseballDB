git init
require(devtools)
git init
setwd("~/Baseball/baseballDB/R")
library(baseballDB)
library(baseballDB)
library(baseballDB)
library(baseballDB)
x<-fread(https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?station=JFK&data=all&year1=2017&month1=1&day1=1&year2=2017&month2=1&day2=1&tz=Etc%2FUTC&format=onlycomma&latlon=no&direct=yes&report_type=1&report_type=2,sep=",",header=TRUE)
x<-fread("https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?station=JFK&data=all&year1=2017&month1=1&day1=1&year2=2017&month2=1&day2=1&tz=Etc%2FUTC&format=onlycomma&latlon=no&direct=yes&report_type=1&report_type=2",sep=",",header=TRUE)
library(data.table)
x<-fread("https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?station=JFK&data=all&year1=2017&month1=1&day1=1&year2=2017&month2=1&day2=1&tz=Etc%2FUTC&format=onlycomma&latlon=no&direct=yes&report_type=1&report_type=2",sep=",",header=TRUE)
x
x<-fread("https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?station=KJFK&data=all&year1=2017&month1=1&day1=1&year2=2017&month2=1&day2=1&tz=Etc%2FUTC&format=onlycomma&latlon=no&direct=yes&report_type=1&report_type=2",sep=",",header=TRUE)
x
x<-fread("https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?station=DSW&data=all&year1=2017&month1=1&day1=1&year2=2017&month2=1&day2=1&tz=Etc%2FUTC&format=onlycomma&latlon=no&direct=yes&report_type=1&report_type=2",sep=",",header=TRUE)
x
x<-fread("https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?station=DWI&data=all&year1=2017&month1=1&day1=1&year2=2017&month2=1&day2=1&tz=Etc%2FUTC&format=onlycomma&latlon=no&direct=yes&report_type=1&report_type=2",sep=",",header=TRUE)
x
x<-fread("https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?station=DTW&data=all&year1=2017&month1=1&day1=1&year2=2017&month2=1&day2=1&tz=Etc%2FUTC&format=onlycomma&latlon=no&direct=yes&report_type=1&report_type=2",sep=",",header=TRUE)
x
x<-fread("https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?station=DTW&data=all&year1=2017&month1=1&day1=1&year2=2017&month2=1&day2=1&tz=Etc%2FUTC&format=onlycomma&latlon=no&direct=yes&report_type=1&report_type=2",sep=",",header=TRUE)[tmpf!='M']
x
y=fread("https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?station=DTW&data=all&year1=2017&month1=1&day1=1&year2=2017&month2=1&day2=1&tz=America%2FNew_York&format=onlycomma&latlon=no&direct=no&report_type=1&report_type=2",sep=",",header=TRUE)[tempf!="M"]
y
y=fread("https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?station=DTW&data=all&year1=2017&month1=1&day1=1&year2=2017&month2=1&day2=1&tz=America%2FNew_York&format=onlycomma&latlon=no&direct=no&report_type=1&report_type=2",sep=",",header=TRUE)
y
y=fread("https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?station=DTW&data=all&year1=2017&month1=1&day1=1&year2=2017&month2=1&day2=1&tz=America%2FNew_York&format=onlycomma&latlon=no&direct=no&report_type=1&report_type=2",sep=",",header=TRUE)[tempf!="M"]
y
y=fread("https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?station=DTW&data=all&year1=2017&month1=1&day1=1&year2=2017&month2=1&day2=1&tz=America%2FNew_York&format=onlycomma&latlon=no&direct=no&report_type=1&report_type=2",sep=",",header=TRUE)[tmpf!="M"]
y
y=fread("https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?station=DTW&data=all&year1=2017&month1=1&day1=1&year2=2017&month2=1&day2=1&tz=America%2FChicago&format=onlycomma&latlon=no&direct=no&report_type=1&report_type=2",sep=",",header=TRUE)
y
tz="America/New_York"
strsplit(tz,"/")
paste(strsplit(tz,"/"),"%2F")
paste(tstrsplit(tz,"/"),"%2F")
strsplit(tz,"/")[1]
tstrsplit(tz,"/")[1]
paste(tstrsplit(tz,"/")[1],tstrsplit(tz,"/")[2],"%2F")
paste(tstrsplit(tz,"/")[1],"%2F",tstrsplit(tz,"/")[2])
paste0(tstrsplit(tz,"/")[1],"%2F",tstrsplit(tz,"/")[2])
paste0(http,tstrsplit(tz,"/")[1],"%2F",tstrsplit(tz,"/")[2])
paste0('http',tstrsplit(tz,"/")[1],"%2F",tstrsplit(tz,"/")[2])
gameday=as.Date("2015-05-01")
month(gameday)
day(gameday)
mday(gameday)
station="DTW"
start="2017-01-01"
stop="2017-01-01"
start=as.Date("2017-01-01")
stop=start
year(stop)
paste0('http',paste0(tstrsplit(tz,"/")[1],"%2F",tstrsplit(tz,"/")[2]))
tz
url=paste0('https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?',
station=station,
&data=all&,
year1=year(start)&month1=month(start)&day1=mday(start)&,
year2=year(stop)&month2=month(stop)&day2=mday(stop)&,
tz=paste0(tstrsplit(tz,'/')[1],"%2F",tstrsplit(tz,'/')[2]),
format=onlycomma&latlon=no&direct=no&report_type=1&report_type=2")
url=paste0('https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?',
'station=station&',
'data=all&',
'year1=',year(start),'&month1='month(start),'&day1='mday(start),
'&year2='year(stop),'&month2='month(stop),'&day2='mday(stop),
'&tz='paste0(tstrsplit(tz,'/')[1],"%2F",tstrsplit(tz,'/')[2]),
'format=onlycomma&latlon=no&direct=no&report_type=1&report_type=2')
url=paste0('https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?','station=station&','data=all&','year1=',year(start),'&month1='month(start),'&day1='mday(start),'&year2='year(stop),'&month2='month(stop),'&day2='mday(stop),'&tz='paste0(tstrsplit(tz,'/')[1],"%2F",tstrsplit(tz,'/')[2]),'format=onlycomma&latlon=no&direct=no&report_type=1&report_type=2')
url=paste0('https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?','station='station,'&data=all&','year1=',year(start),'&month1='month(start),'&day1='mday(start),'&year2='year(stop),'&month2='month(stop),'&day2='mday(stop),'&tz='paste0(tstrsplit(tz,'/')[1],"%2F",tstrsplit(tz,'/')[2]),'format=onlycomma&latlon=no&direct=no&report_type=1&report_type=2')
url=paste0('https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?','station='station,'&data=all&year1=',year(start),'&month1='month(start),'&day1='mday(start),'&year2='year(stop),'&month2='month(stop),'&day2='mday(stop),'&tz='paste0(tstrsplit(tz,'/')[1],"%2F",tstrsplit(tz,'/')[2]),'format=onlycomma&latlon=no&direct=no&report_type=1&report_type=2')
url=paste0('https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?',
'station='station,
'&data=all&year1=',
year(start),
'&month1='month(start),
'&day1='mday(start),
'&year2='year(stop),
'&month2='month(stop),
'&day2='mday(stop),
'&tz='paste0(tstrsplit(tz,'/')[1],"%2F",tstrsplit(tz,'/')[2]),
'format=onlycomma&latlon=no&direct=no&report_type=1&report_type=2')
s='https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?'
s
url=paste0('https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?',
'station='station)
station
url=paste0('https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?',
'station=',station),
'&data=all&year1=',
year(start),
'&month1=',month(start),
'&day1=',mday(start),
'&year2=',year(stop),
'&month2=',month(stop),
'&day2=',mday(stop),
'&tz=',paste0(tstrsplit(tz,'/')[1],"%2F",tstrsplit(tz,'/')[2]),
'format=onlycomma&latlon=no&direct=no&report_type=1&report_type=2')
url=paste0('https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?',
'station=',station)
url=paste0('https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?',
'station=',station,
'&data=all&year1=',year(start),
'&month1=',month(start),
'&day1=',mday(start),
'&year2=',year(stop),
'&month2=',month(stop),
'&day2=',mday(stop),
'&tz=',paste0(tstrsplit(tz,'/')[1],"%2F",tstrsplit(tz,'/')[2]),
'format=onlycomma&latlon=no&direct=no&report_type=1&report_type=2')
url
x=fread(url,sep=",",header=TRUE)
x
url=paste0('https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?',
'station=',station,
'&data=all&year1=',year(start),
'&month1=',month(start),
'&day1=',mday(start),
'&year2=',year(stop),
'&month2=',month(stop),
'&day2=',mday(stop),
'&tz=',paste0(tstrsplit(tz,'/')[1],"%2F",tstrsplit(tz,'/')[2]),
'&format=onlycomma&latlon=no&direct=no&report_type=1&report_type=2')
x=fread(url,sep=",",header=TRUE)
x
x=fread(url,sep=",",header=TRUE)[tmpf!="M"]
x
start_date=start
stop_date=stop
url = paste0('https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?',
'station=' , station,
'&data=all&year1=' , year(start_date),
'&month1=' , month(start_date),
'&day1=' , mday(start_date),
'&year2=' , year(stop_date),
'&month2=' , month(stop_date),
'&day2=' , mday(stop_date),
'&tz=' , paste0(tstrsplit(tz,'/')[1],"%2F",tstrsplit(tz,'/')[2])
url
url=paste0('https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?',
'station=',station,
'&data=all&year1=',year(start_date),
'&month1=',month(start_date),
'&day1=',mday(start_date),
'&year2=',year(stop_date),
'&month2=',month(stop_date),
'&day2=',mday(stop_date),
'&tz=',paste0(tstrsplit(tz,'/')[1],"%2F",tstrsplit(tz,'/')[2])
url = paste0('https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?',
'station=' , station,
'&data=all&year1=' , year(start_date),
'&month1=' , month(start_date),
'&day1=' , mday(start_date),
'&year2=' , year(stop_date),
'&month2=' , month(stop_date),
'&day2=' , mday(stop_date),
'&tz=' , paste0(tstrsplit(tz,'/')[1],"%2F",tstrsplit(tz,'/')[2]),
'&format=onlycomma&latlon=no&direct=no&report_type=1&report_type=2')
url
vars = c('station', 'valid', 'tmpf', 'relh', 'alti')
colnames = c('station', 'time', 'tempf', 'humidity', 'pressure')
data = fread(url, sep = ",", header = TRUE)[tmpf!=][vars]
data = fread(url, sep = ",", header = TRUE)[tmpf!='M'][vars]
data = fread(url, sep = ",", header = TRUE)[tmpf!='M']
data = fread(url, sep = ",", header = TRUE)[tmpf!='M'][,..vars]
data
colnames(data) = colnames
return(data)
gamedate=as.POSIXct("2017-01-01 7:15:15",tz="America/New_York")
gamedate
year(gamedate)
data
data$time[1]-gamedate
as.POSIX(data$time[1],tz="America/New_York")-gamedate
as.POSIXct(data$time[1],tz="America/New_York")-gamedate
min(as.POSIXct(data$time,tz="America/New_York")-gamedate)
data[min(as.POSIXct(data$time,tz="America/New_York")-gamedate)]
data[,min(as.POSIXct(data$time,tz="America/New_York")-gamedate)]
data[min(as.POSIXct(data$time,tz="America/New_York")-gamedate),]
data[which.min(as.POSIXct(data$time,tz="America/New_York")-gamedate),]
data[which.max(as.POSIXct(data$time,tz="America/New_York")-gamedate),]
data[,dif=(as.POSIXct(data$time,tz="America/New_York")-gamedate),which.min(dif)]
data[dif=(as.POSIXct(data$time,tz="America/New_York")-gamedate),which.min(dif)]
data[,dif=(as.POSIXct(data$time,tz="America/New_York")-gamedate)]
data[,dif:=(as.POSIXct(data$time,tz="America/New_York")-gamedate)]
data
data[,dif:=(as.POSIXct(data$time,tz="America/New_York")-gamedate)][which.min(dif)]
data[,dif:=(as.POSIXct(data$time,tz="America/New_York")-gamedate)][which.min(dif)][dif:=NULL]
data[,dif:=(as.POSIXct(data$time,tz="America/New_York")-gamedate)][which.min(dif)][dif=NULL]
data[,dif:=(as.POSIXct(data$time,tz="America/New_York")-gamedate)][which.min(dif)][dif:=NULL]
data[,dif:=abs(as.POSIXct(data$time,tz="America/New_York")-gamedate)][which.min(dif)]
data[,dif:=abs(as.POSIXct(data$time,tz="America/New_York")-gamedate)][which.min(dif)][dif:=NULL]
data[,dif:=abs(as.POSIXct(time,tz="America/New_York")-gamedate)][which.min(dif)]
weatherFinder = function(station, gamedate){
url = paste0('https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?',
'station=', station,
'&data=all&year1=', year(gamedate),
'&month1=', month(gamedate),
'&day1=', mday(gamedate),
'&year2=', year(gamedate),
'&month2=', month(gamedate),
'&day2=', mday(gamedate),
'&tz=', paste0(tstrsplit(tz,'/')[1],"%2F",tstrsplit(tz,'/')[2]),
'&format=onlycomma&latlon=no&direct=no&report_type=1&report_type=2'),
vars = c('station', 'valid', 'tmpf', 'relh', 'alti'),
colnames = c('station', 'time', 'tempf', 'humidity', 'pressure'),
data = fread(url, sep = ",", header = TRUE)[tmpf!='M'][,..vars],
colnames(data) = colnames,
return(data[time_dif:=abs(as.POSICXT(time)-gamedate)][which.min(time_dif)])
}
gamedate
url = paste0('https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?',
'station=', station,
'&data=all&year1=', year(gamedate),
'&month1=', month(gamedate),
'&day1=', mday(gamedate),
'&year2=', year(gamedate),
'&month2=', month(gamedate),
'&day2=', mday(gamedate),
'&tz=', paste0(tstrsplit(tz,'/')[1],"%2F",tstrsplit(tz,'/')[2]),
'&format=onlycomma&latlon=no&direct=no&report_type=1&report_type=2'),
url = paste0('https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?',
'station=', station,
'&data=all&year1=', year(gamedate),
'&month1=', month(gamedate),
'&day1=', mday(gamedate),
'&year2=', year(gamedate),
'&month2=', month(gamedate),
'&day2=', mday(gamedate),
'&tz=', paste0(tstrsplit(tz,'/')[1],"%2F",tstrsplit(tz,'/')[2]),
'&format=onlycomma&latlon=no&direct=no&report_type=1&report_type=2')
url
data[time_dif:=abs(as.POSICXT(time)-gamedate)][which.min(time_dif)]
data[,time_dif:=abs(as.POSICXT(time)-gamedate)][which.min(time_dif)]
data[,time_dif:=abs(as.POSIXct(time)-gamedate)][which.min(time_dif)]
weatherFinder = function(station, gamedate){
url = paste0('https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?',
'station=', station,
'&data=all&year1=', year(gamedate),
'&month1=', month(gamedate),
'&day1=', mday(gamedate),
'&year2=', year(gamedate),
'&month2=', month(gamedate),
'&day2=', mday(gamedate),
'&tz=', paste0(tstrsplit(tz,'/')[1],"%2F",tstrsplit(tz,'/')[2]),
'&format=onlycomma&latlon=no&direct=no&report_type=1&report_type=2');
vars = c('station', 'valid', 'tmpf', 'relh', 'alti');
colnames = c('station', 'time', 'tempf', 'humidity', 'pressure');
data = fread(url, sep = ",", header = TRUE)[tmpf!='M'][,..vars];
colnames(data) = colnames;
return(data[,time_dif:=abs(as.POSIXct(time)-gamedate)][which.min(time_dif)])
}
weath<-weatherFinder(station,gamedate)
weath
weatherFinder = function(station, gamedate){
url = paste0('https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?',
'station=', station,
'&data=all&year1=', year(gamedate),
'&month1=', month(gamedate),
'&day1=', mday(gamedate),
'&year2=', year(gamedate),
'&month2=', month(gamedate),
'&day2=', mday(gamedate),
'&tz=', paste0(tstrsplit(tz,'/')[1],"%2F",tstrsplit(tz,'/')[2]),
'&format=onlycomma&latlon=no&direct=no&report_type=1&report_type=2');
vars = c('station', 'valid', 'tmpf', 'relh', 'alti');
colnames = c('station', 'time', 'tempf', 'humidity', 'pressure');
data = fread(url, sep = ",", header = TRUE,verbose=FALSE)[tmpf!='M'][,..vars];
colnames(data) = colnames;
return(data[,time_dif:=abs(as.POSIXct(time)-gamedate)][which.min(time_dif)])
}
weath<-weatherFinder(station,gamedate)
weatherFinder = function(station, gamedate){
url = paste0('https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?',
'station=', station,
'&data=all&year1=', year(gamedate),
'&month1=', month(gamedate),
'&day1=', mday(gamedate),
'&year2=', year(gamedate),
'&month2=', month(gamedate),
'&day2=', mday(gamedate),
'&tz=', paste0(tstrsplit(tz,'/')[1],"%2F",tstrsplit(tz,'/')[2]),
'&format=onlycomma&latlon=no&direct=no&report_type=1&report_type=2');
vars = c('station', 'valid', 'tmpf', 'relh', 'alti');
colnames = c('station', 'time', 'tempf', 'humidity', 'pressure');
data = fread(url, sep = ",", header = TRUE,verbose=FALSE,showProgress = FALSE)[tmpf!='M'][,..vars];
colnames(data) = colnames;
return(data[,time_dif:=abs(as.POSIXct(time)-gamedate)][which.min(time_dif)])
}
weath<-weatherFinder(station,gamedate)
station='YYZ'
weath<-weatherFinder(station,gamedate)
weath
station='CYYZ'
weath
weath<-weatherFinder(station,gamedate)
weath
test_data=data.table(
stations=c('JFK','LAX','JFK','SEA','YYZ','JFK','LAX','STL','BOS','PHX'),
dates=as.POSIXct("2015-05-01 00:15:17","2017-01-07 12:00:00","2015-05-01 00:15:17",
"2017-01-07 12:00:00","2015-05-01 00:15:17","2017-01-07 12:00:00",
"2015-05-01 00:15:17","2017-01-07 12:00:00","2015-05-01 00:15:17",
"2017-01-07 12:00:00")
)
test_data=data.table(
stations=c('JFK','LAX','JFK','SEA','YYZ','JFK','LAX','STL','BOS','PHX'),
dates=as.POSIXct(c("2015-05-01 00:15:17","2017-01-07 12:00:00","2015-05-01 00:15:17",
"2017-01-07 12:00:00","2015-05-01 00:15:17","2017-01-07 12:00:00",
"2015-05-01 00:15:17","2017-01-07 12:00:00","2015-05-01 00:15:17",
"2017-01-07 12:00:00"),tz='UTC')
)
test_data=data.table(
stations=c('JFK','LAX','JFK','SEA','YYZ','JFK','LAX','STL','BOS','PHX'),
dates=("2015-05-01 00:15:17","2017-01-07 12:00:00","2015-05-01 00:15:17",
"2017-01-07 12:00:00","2015-05-01 00:15:17","2017-01-07 12:00:00",
"2015-05-01 00:15:17","2017-01-07 12:00:00","2015-05-01 00:15:17",
"2017-01-07 12:00:00")
)
test_data=data.table(
stations=c('JFK','LAX','JFK','SEA','YYZ','JFK','LAX','STL','BOS','PHX'),
dates=c("2015-05-01 00:15:17","2017-01-07 12:00:00","2015-05-01 00:15:17",
"2017-01-07 12:00:00","2015-05-01 00:15:17","2017-01-07 12:00:00",
"2015-05-01 00:15:17","2017-01-07 12:00:00","2015-05-01 00:15:17",
"2017-01-07 12:00:00")
)
test_data$dates=as.POSIXct(test_data$dates,tz='UTC')
index=colnames(test_data)
index
weath=tapply(test_data,index=index,weatherFinder)
weath=mapply(weatherFinder,test_data$stations,test_data$dates)
weath
weath=mapply(weatherFinder,test_data$stations,test_data$dates,SIMPLIFY = TRUE)
weath
test_data=data.table(
stations=rep(c('JFK','LAX','JFK','SEA','CYYZ','JFK','LAX','STL','BOS','PHX'),
dates=c("2015-05-01 00:15:17","2017-01-07 12:00:00","2015-05-01 00:15:17",
"2017-01-07 12:00:00","2015-05-01 00:15:17","2017-01-07 12:00:00",
"2015-05-01 00:15:17","2017-01-07 12:00:00","2015-05-01 00:15:17",
"2017-01-07 12:00:00")
)
test_data=data.table(
stations=c('JFK','LAX','JFK','SEA','CYYZ','JFK','LAX','STL','BOS','PHX'),
dates=c("2015-05-01 00:15:17","2017-01-07 12:00:00","2015-05-01 00:15:17",
"2017-01-07 12:00:00","2015-05-01 00:15:17","2017-01-07 12:00:00",
"2015-05-01 00:15:17","2017-01-07 12:00:00","2015-05-01 00:15:17",
"2017-01-07 12:00:00")
)
weath=t(mapply(weatherFinder,test_data$stations,test_data$dates))
test_data=data.table(
stations=c('JFK','LAX','JFK','SEA','CYYZ','JFK','LAX','STL','BOS','PHX'),
dates=c("2015-05-01 00:15:17","2017-01-07 12:00:00","2015-05-01 00:15:17",
"2017-01-07 12:00:00","2015-05-01 00:15:17","2017-01-07 12:00:00",
"2015-05-01 00:15:17","2017-01-07 12:00:00","2015-05-01 00:15:17",
"2017-01-07 12:00:00")
)
test_data$dates=as.POSIXct(test_data$dates,tz='UTC')
index=colnames(test_data)
weath=mapply(weatherFinder,test_data$stations,test_data$dates)
weath
t(weath)
print(weatherFinder(test_data$stations[1],test_data$dates[1]))
print(weatherFinder(test_data$stations[2],test_data$dates[2]))
weath=mapply(weatherFinder,test_data$stations,test_data$dates,USE.NAMES = FALSE)
t(weath)
t(mapply(weatherFinder,test_data$stations,test_data$dates,USE.NAMES = FALSE))
test_data=cbind(test_data,t(mapply(weatherFinder,test_data$stations,test_data$dates,USE.NAMES = FALSE)))
test_data
test_data=data.table(
stations=c('JFK','LAX','JFK','SEA','CYYZ','JFK','LAX','STL','BOS','PHX'),
dates=c("2015-05-01 00:15:17","2017-01-07 12:00:00","2015-05-01 00:15:17",
"2017-01-07 12:00:00","2015-05-01 00:15:17","2017-01-07 12:00:00",
"2015-05-01 00:15:17","2017-01-07 12:00:00","2015-05-01 00:15:17",
"2017-01-07 12:00:00")
)
test_data$dates=as.POSIXct(test_data$dates,tz='America/New_York')
index=colnames(test_data)
test_data=cbind(test_data,t(mapply(weatherFinder,test_data$stations,test_data$dates,USE.NAMES = FALSE)))
test_data
library(baseballDB)
library("XML", lib.loc="/Library/Frameworks/R.framework/Versions/3.4/Resources/library")
library("xml2", lib.loc="/Library/Frameworks/R.framework/Versions/3.4/Resources/library")
library("XML2R", lib.loc="/Library/Frameworks/R.framework/Versions/3.4/Resources/library")
library(rvest)
library(stringr)
a = html(“http://gd2.mlb.com/components/game/mlb/year_2014/month_05/day_01/”) %>%
html_nodes(“a”) %>% html_text %>% str_trim
a = html(“http://gd2.mlb.com/components/game/mlb/year_2014/month_05/day_01/”) %>%html_nodes(“a”) %>% html_text %>% str_trim
library(dplyr)
a = html(“http://gd2.mlb.com/components/game/mlb/year_2014/month_05/day_01/”) %>%html_nodes(“a”) %>% html_text %>% str_trim
a = html(“http://gd2.mlb.com/components/game/mlb/year_2014/month_05/day_01/”)%>%
html_nodes(“a”) %>% html_text %>% str_trim
a = html(“http://gd2.mlb.com/components/game/mlb/year_2014/month_05/day_01/”)
a = read_html(“http://gd2.mlb.com/components/game/mlb/year_2014/month_05/day_01/”) %>%
html_nodes(“a”) %>% html_text %>% str_trim
a = read_html(“http://gd2.mlb.com/components/game/mlb/year_2014/month_05/day_01/”)
a = read_html(http://gd2.mlb.com/components/game/mlb/year_2014/month_05/day_01/)
a = read_html('http://gd2.mlb.com/components/game/mlb/year_2014/month_05/day_01/')
html_nodes(a)
html_nodes('a')
a
View(a)
a
a = read_html('http://gd2.mlb.com/components/game/mlb/year_2014/month_05/day_01/')%>%
html_nodes(“a”) %>% html_text %>% str_trim
a = read_html('http://gd2.mlb.com/components/game/mlb/year_2014/month_05/day_01/')%>%
html_nodes('a) %>% html_text %>% str_trim
missed <- sub("/$", "", a[grepl("^gid_.*2/$", a)])
a = read_html('http://gd2.mlb.com/components/game/mlb/year_2014/month_05/day_01/')%>%
html_nodes('a') %>% html_text %>% str_trim
a
gids<-a[grepl("^gid_")]
gids<-a[grep("gid_",a)]
gids
red_button('yes')
setwd("~/Baseball/baseballDB")
library(baseballDB)
station="PHX"
gamedate="2017-04-01 20:10:37"
typeof(gamedate)
gamedate=as.POSIXct("2017-04-01 20:10:37")
gamedate
gamedate=as.POSIXct("2017-04-01 20:10:37",tz="UTC")
gamedate
url = paste0('https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?',
'station=', station,
'&data=all&year1=', year(gamedate),
'&month1=', month(gamedate),
'&day1=', mday(gamedate),
'&year2=', year(gamedate),
'&month2=', month(gamedate),
'&day2=', mday(gamedate),
'&tz=Etc%2FUTC&format=onlycomma&latlon=no&direct=no&report_type=1&report_type=2')
fread(url)
url = paste0('https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?',
'station=', station,
'&data=all&year1=', year(gamedate),
'&month1=', month(gamedate),
'&day1=', mday(gamedate),
'&year2=', year(gamedate),
'&month2=', month(gamedate),
'&day2=', mday(gamedate),
'&tz=Etc%2FUTC&format=onlycomma&latlon=no&direct=no&report_type=1&report_type=2');
vars = c('station', 'valid', 'tmpf', 'relh', 'alti');
colnames = c('station', 'time', 'tempf', 'humidity', 'pressure');
data = fread(url, sep = ",", header = TRUE,verbose=FALSE)[tmpf!='M'][,..vars];
colnames(data) = colnames
data
library(baseballDB)
data
summary(data)
data[3:5]
data[,3:5]
data[,3:5]<-<-as.numeric(data[,3:5])
x=5
